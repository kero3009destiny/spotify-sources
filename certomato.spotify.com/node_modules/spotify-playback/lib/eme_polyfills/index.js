'use strict';

var debugLogger = require('spotify-debug-tools/logging').forTag(
  'eme_polyfills.tester'
);

var IEPolyfill = require('./ms_ie');
var V01bPolyfill = require('./v0_1b');

module.exports = {

  install: function() {
    var navigator = global.navigator;

    if (
      navigator && navigator.requestMediaKeySystemAccess &&
      global.MediaKeySystemAccess &&
      global.MediaKeySystemAccess.prototype.getConfiguration
    ) {
      debugLogger.log('Using native EME implementation.');
      return 'native';
    } else if (
      global.HTMLMediaElement &&
      global.HTMLMediaElement.prototype.webkitGenerateKeyRequest
    ) {
      debugLogger.log('Detected "webkit" Prefixed EME v0.1b. Polyfilling.');
      V01bPolyfill.setup('webkit');
      return 'v0.1b-webkit';
    } else if (
      global.HTMLMediaElement &&
      global.HTMLMediaElement.prototype.generateKeyRequest
    ) {
      debugLogger.log('Detected Unprefixed EME v0.1b. Polyfilling.');
      V01bPolyfill.setup();
      return 'v0.1b';
    } else if (global.MSMediaKeys) {
      debugLogger.log('Detected MS IE EME. Polyfilling.');
      IEPolyfill.setup();
      return 'ms-ie';
    }

    debugLogger.warn('Detected no EME APIs.');
    return null;
  }

};

